function [M,C,G,P] = dynMatsMode2(q,dq)
%helper function to numerically calculate dynamics matrices M (inertia), C
%(coriolis) and G (gravity) given state vector q and its derivatives

q0 = q(1); tht = q(2);
dq0 = dq(1); dtht = dq(2);

% fprintf("q:\n"); disp(q);
% fprintf("\ndq:\n"); disp(dq);
% fprintf("\nqo:\n"); disp(q0);
% fprintf("\ntht:\n"); disp(tht);
% fprintf("\ndq0:\n"); disp(dq0);
% fprintf("\ndtht:\n"); disp(dtht);

[D,L,g,m,phi,~,~,~,~,~,~] = getVars();

t2 = cos(q0);
t3 = cos(tht);
t4 = sin(q0);
t5 = sin(tht);
t6 = q0+tht;
t7 = q0.*2.0;
t8 = q0.^2;
t9 = q0.^3;
t11 = (q0 ~= 0.0);
t12 = tht.*2.0;
t20 = 1.0./q0;
t10 = t8.^2;
t13 = t2.*2.0;
t14 = cos(t12);
t15 = t4.*2.0;
t16 = t4.*4.0;
t17 = sin(t12);
t18 = cos(t6);
t19 = sin(t6);
t21 = 1.0./t8;
t22 = t20.^5;
t24 = -t3;
t25 = t6+tht;
t30 = t6.*2.0;
t23 = t21.^3;
t26 = cos(t25);
t27 = sin(t25);
t28 = t14.*2.0;
t29 = t17.*2.0;
t31 = -t14;
t32 = cos(t30);
t35 = sin(t30);
t43 = t14.*(1.1e+1./2.0);
t44 = t14.*(1.1e+1./4.0);
t45 = t17.*(1.1e+1./4.0);
t46 = t18+t24;
t51 = t14./1.2e+3;
t52 = t14./2.4e+3;
t53 = t17./2.4e+3;
t64 = t14.*3.000416666666667;
t65 = t14.*1.500208333333333;
t66 = t17.*1.500208333333333;
t33 = t26.*2.0;
t34 = t26.*4.0;
t36 = t27.*2.0;
t37 = t27.*4.0;
t40 = t26.*8.0;
t48 = -t45;
t49 = t32.*3.0;
t50 = t35.*3.0;
t56 = t32.*(3.0./2.0);
t57 = t32.*(5.0./2.0);
t58 = t32.*(5.0./4.0);
t59 = t35.*(3.0./2.0);
t60 = t35.*(5.0./4.0);
t67 = -t66;
t68 = t32./6.0e+2;
t69 = t32./1.2e+3;
t70 = t32./2.4e+3;
t71 = t35./1.2e+3;
t72 = t35./2.4e+3;
t78 = t32.*1.999583333333333;
t79 = t32.*9.997916666666667e-1;
t80 = t35.*1.999583333333333;
t81 = t35.*9.997916666666667e-1;
t82 = t10.*t32.*(-1.0./6.0e+2);
if (t11)
    t136 = -t22.*(t44-cos(t25).*4.0+cos(t30).*(5.0./4.0)-t8.*(t65-cos(t25).*2.0+cos(t30).*9.997916666666667e-1)-q0.*(t17+sin(t25).*2.0-sin(t30).*(3.0./2.0))+t10.*(t52-cos(t30)./1.2e+3)+t9.*(t17+sin(t30)./2.4e+3));
else
    t136 = NaN;
end
t38 = -t33;
t39 = -t34;
t41 = -t36;
t42 = -t37;
t47 = -t40;
t54 = -t49;
t55 = -t50;
t61 = -t56;
t62 = -t59;
t63 = -t60;
t73 = -t68;
t74 = -t69;
t75 = -t71;
t76 = t10.*t68;
t77 = t9.*t71;
t83 = -t78;
t84 = -t81;
t85 = t17+t72;
t86 = t29+t71;
t87 = t14+t70+7.0./3.0;
t88 = t14+t70-7.0./3.0;
t89 = t9.*t85;
t90 = t15+t41+t50;
t91 = t9.*t86;
t92 = t29+t37+t55;
t94 = t17+t36+t62;
t95 = t9.*t87;
t97 = t9.*t88;
t98 = t8.*t87.*3.0;
t99 = t51+t73;
t100 = t52+t74;
t102 = t53+t75;
t107 = t13+t14+t33+t61+2.0;
t109 = t13+t33+t83;
t115 = t13+t31+t38+t56+2.0;
t120 = t39+t64+t78;
t121 = t38+t65+t79;
t124 = t15+t41+t66+t81;
t125 = t15+t36+t67+t84;
t93 = q0.*t90;
t96 = q0.*t92;
t101 = q0.*t94;
t103 = -t95;
t104 = -t98;
t108 = t10.*t102;
t110 = t10.*t99;
t111 = t10.*t100;
t112 = t9.*t102.*4.0;
t113 = q0.*t107;
t117 = q0.*t115;
t118 = t8.*t109;
t122 = t8.*t120;
t123 = t8.*t121;
t128 = t7.*t125;
t129 = t8.*t124;
t130 = t8.*t125;
t105 = -t96;
t106 = -t101;
t114 = -t108;
t116 = -t113;
t119 = -t117;
t126 = -t122;
t127 = -t123;
t140 = t13+t14+t32+t38+t77+t82+t93+t104+t112+t118+t128-2.0;
t131 = t39+t44+t58+t89+t106+t111+t127;
t132 = t43+t47+t57+t91+t105+t110+t126;
t137 = t16+t37+t48+t63+t97+t114+t116+t129;
t138 = t16+t42+t45+t60+t103+t108+t119+t130;
M = reshape([-t22.*t137+1.0./9.0e+2,t136,t136,-t22.*t138+1.0./9.0e+2],[2,2]);
if nargout > 1
    et1 = (t22.*(t13+t31+cos(t25).*2.0-cos(t30)+t8.*(t13-cos(t25).*2.0+cos(t30).*1.999583333333333)+q0.*(t15+sin(t25).*2.0-sin(t30).*3.0)+t7.*(t15+t66-sin(t25).*2.0+sin(t30).*9.997916666666667e-1)+(t10.*cos(t30))./6.0e+2-(t9.*sin(t30))./1.2e+3+t8.*(t14+cos(t30)./2.4e+3-7.0./3.0).*3.0-t9.*(t53-sin(t30)./1.2e+3).*4.0-2.0))./2.0;
    et2 = t23.*(t16+t48+sin(t25).*4.0-sin(t30).*(5.0./4.0)+t9.*(t14+cos(t30)./2.4e+3-7.0./3.0)-q0.*(cos(t25).*2.0+t14-cos(t30).*(3.0./2.0)+t13+2.0)-t10.*(t53-sin(t30)./1.2e+3)+t8.*(sin(t25).*-2.0+t66+sin(t30).*9.997916666666667e-1+t15)).*(-5.0./2.0);
    et3 = t22.*(t43-cos(t25).*8.0+cos(t30).*(5.0./2.0)+t10.*(t51-cos(t30)./6.0e+2)+t9.*(t29+sin(t30)./1.2e+3)-t8.*(cos(t25).*-4.0+t64+cos(t30).*1.999583333333333)-q0.*(sin(t25).*4.0+t29-sin(t30).*3.0)).*(-1.0./2.0)+t23.*(t44-cos(t25).*4.0+cos(t30).*(5.0./4.0)+t10.*(t52-cos(t30)./1.2e+3)+t9.*(t17+sin(t30)./2.4e+3)-t8.*(cos(t25).*-2.0+t65+cos(t30).*9.997916666666667e-1)-q0.*(sin(t25).*2.0+t17-sin(t30).*(3.0./2.0))).*5.0;
    et4 = t22.*(t17-sin(t25).*2.0+sin(t30)-(t9.*cos(t30))./1.2e+3-(t10.*sin(t30))./6.0e+2-t9.*(t52-cos(t30)./1.2e+3).*4.0-t8.*(t17+sin(t30)./2.4e+3).*3.0+q0.*(cos(t25).*2.0-cos(t30).*3.0)+t8.*(sin(t25).*2.0-sin(t30).*1.999583333333333)+(cos(t25).*-2.0+t65+cos(t30).*9.997916666666667e-1).*t7);
    et5 = t23.*(t16+t45-sin(t25).*4.0+sin(t30).*(5.0./4.0)-t9.*(t14+cos(t30)./2.4e+3+7.0./3.0)-q0.*(cos(t25).*-2.0+t31+cos(t30).*(3.0./2.0)+t13+2.0)+t10.*(t53-sin(t30)./1.2e+3)+t8.*(sin(t25).*2.0+t67-sin(t30).*9.997916666666667e-1+t15)).*(5.0./2.0);
    et6 = t22.*(t13+t14-cos(t25).*2.0+cos(t30)-(t10.*cos(t30))./6.0e+2+(t9.*sin(t30))./1.2e+3-t8.*(t14+cos(t30)./2.4e+3+7.0./3.0).*3.0+t9.*(t53-sin(t30)./1.2e+3).*4.0+(sin(t25).*2.0+t67-sin(t30).*9.997916666666667e-1+t15).*t7+t8.*(cos(t25).*2.0-cos(t30).*1.999583333333333+t13)+q0.*(sin(t25).*-2.0+sin(t30).*3.0+t15)-2.0).*(-1.0./2.0);
    et7 = t22.*(t17.*(1.1e+1./2.0)-sin(t25).*8.0+sin(t30).*(5.0./2.0)-t9.*(t28+cos(t30)./1.2e+3)-t8.*(sin(t25).*-4.0+t17.*3.000416666666667+sin(t30).*1.999583333333333)+t10.*(t17./1.2e+3-sin(t30)./6.0e+2)+q0.*(cos(t25).*4.0+t28-cos(t30).*3.0));
    et8 = t23.*(t16+t45-sin(t25).*4.0+sin(t30).*(5.0./4.0)-t9.*(t14+cos(t30)./2.4e+3+7.0./3.0)-q0.*(cos(t25).*-2.0+t31+cos(t30).*(3.0./2.0)+t13+2.0)+t10.*(t53-sin(t30)./1.2e+3)+t8.*(sin(t25).*2.0+t67-sin(t30).*9.997916666666667e-1+t15)).*(-5.0./2.0);
    et9 = (t22.*(t13+t14-cos(t25).*2.0+cos(t30)+t8.*(t13+cos(t25).*2.0-cos(t30).*1.999583333333333)+q0.*(t15-sin(t25).*2.0+sin(t30).*3.0)+t7.*(t15+t67+sin(t25).*2.0-sin(t30).*9.997916666666667e-1)-(t10.*cos(t30))./6.0e+2+(t9.*sin(t30))./1.2e+3-t8.*(t14+cos(t30)./2.4e+3+7.0./3.0).*3.0+t9.*(t53-sin(t30)./1.2e+3).*4.0-2.0))./2.0;
    et10 = t23.*(t16+t45-sin(t25).*4.0+sin(t30).*(5.0./4.0)-t9.*(t14+cos(t30)./2.4e+3+7.0./3.0)-q0.*(cos(t25).*-2.0+t31+cos(t30).*(3.0./2.0)+t13+2.0)+t10.*(t53-sin(t30)./1.2e+3)+t8.*(sin(t25).*2.0+t67-sin(t30).*9.997916666666667e-1+t15)).*(5.0./2.0);
    et11 = t22.*(t13+t14-cos(t25).*2.0+cos(t30)-(t10.*cos(t30))./6.0e+2+(t9.*sin(t30))./1.2e+3-t8.*(t14+cos(t30)./2.4e+3+7.0./3.0).*3.0+t9.*(t53-sin(t30)./1.2e+3).*4.0+(sin(t25).*2.0+t67-sin(t30).*9.997916666666667e-1+t15).*t7+t8.*(cos(t25).*2.0-cos(t30).*1.999583333333333+t13)+q0.*(sin(t25).*-2.0+sin(t30).*3.0+t15)-2.0).*(-1.0./2.0);
    if (t11)    t0 = -dq0.*(et1+et2)+(dtht.*t22.*(t43-cos(t25).*8.0+cos(t30).*(5.0./2.0)-t8.*(t64-cos(t25).*4.0+cos(t30).*1.999583333333333)-q0.*(t29+sin(t25).*4.0-sin(t30).*3.0)+t10.*(t51-cos(t30)./6.0e+2)+t9.*(t29+sin(t30)./1.2e+3)))./2.0;else    t0 = NaN;end;mt1 = [t0];
    if (t11)    t0 = dtht.*(et7+et8+et9)+(dq0.*t22.*(t43-cos(t25).*8.0+cos(t30).*(5.0./2.0)-t8.*(t64-cos(t25).*4.0+cos(t30).*1.999583333333333)-q0.*(t29+sin(t25).*4.0-sin(t30).*3.0)+t10.*(t51-cos(t30)./6.0e+2)+t9.*(t29+sin(t30)./1.2e+3)))./2.0;else    t0 = NaN;end;if (t11)    t1 = dq0.*(et3+et4)+dtht.*(et5+et6);else    t1 = NaN;end;mt2 = [t0,t1];
    if (t11)    t0 = dq0.*(et10+et11)-(dtht.*t22.*(t43-cos(t25).*8.0+cos(t30).*(5.0./2.0)-t8.*(t64-cos(t25).*4.0+cos(t30).*1.999583333333333)-q0.*(t29+sin(t25).*4.0-sin(t30).*3.0)+t10.*(t51-cos(t30)./6.0e+2)+t9.*(t29+sin(t30)./1.2e+3)))./2.0;else    t0 = NaN;end;mt3 = [t0];
    C = reshape([mt1,mt2,mt3],2,2);
end
if nargout > 2
    G = [t5.*t21.*(9.8e+1./5.0)+t19.*t21.*(9.8e+1./5.0)-((t3-t18).*(1.96e+2./5.0))./t9;t3.*t20.*(-9.8e+1./5.0)-t21.*(t5-t19).*(9.8e+1./5.0)];
end
if nargout > 3
    P = t5.*t20.*(-9.8e+1./5.0)+t21.*(t3-t18).*(9.8e+1./5.0);
end
