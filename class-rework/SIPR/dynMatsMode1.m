function [M,C,G,P] = dynMatsMode1(q,dq)
%helper function to numerically calculate dynamics matrices M (inertia), C
%(coriolis) and G (gravity) given state vector q and its derivatives

q0 = q(1); tht = q(2);
dq0 = dq(1); dtht = dq(2);

% fprintf("q:\n"); disp(q);
% fprintf("\ndq:\n"); disp(dq);
% fprintf("\nqo:\n"); disp(q0);
% fprintf("\ntht:\n"); disp(tht);
% fprintf("\ndq0:\n"); disp(dq0);
% fprintf("\ndtht:\n"); disp(dtht);

[D,L,g,m,phi,dt,beta,ke,kd,kp,k,nPoints] = getVars();

t2 = cos(q0);
t3 = cos(tht);
t4 = sin(q0);
t5 = phi+tht;
t6 = D.^2;
t7 = L.^2;
t8 = q0.*2.0;
t9 = q0.^2;
t10 = q0.^3;
t12 = q0.^5;
t13 = (q0 ~= 0.0);
t14 = tht.*2.0;
t21 = 1.0./q0;
t11 = t9.^2;
t15 = cos(t14);
t16 = t3.^2;
t17 = sin(t14);
t18 = cos(t5);
t19 = q0+t5;
t20 = sin(t5);
t22 = 1.0./t9;
t23 = 1.0./t10;
t24 = 1.0./t12;
t28 = q0+t14;
t32 = t8+t14;
t34 = t7.*2.88e+2;
t35 = q0.*t7.*1.2e+1;
t43 = t7.*t8.*t9;
t44 = t4.*t7.*2.4e+1;
t48 = t6.*t12.*1.6e+1;
t56 = t7.*t10.*1.92e+2;
t57 = t2.*t7.*-2.88e+2;
t58 = t4.*t7.*5.76e+2;
t62 = q0.*t4.*t7.*8.64e+2;
t64 = t7.*t9.*5.76e+2;
t98 = t4.*t7.*t9.*-2.88e+2;
t25 = t22.^3;
t26 = cos(t19);
t27 = sin(t19);
t29 = cos(t28);
t30 = sin(t28);
t31 = q0.*t20;
t33 = -t18;
t36 = cos(t32);
t38 = sin(t32);
t39 = q0.*t34;
t40 = t15./2.0;
t41 = t15./4.0;
t42 = t17./4.0;
t45 = t2.*t35;
t47 = t17./8.0;
t49 = t2.*t34;
t50 = -t44;
t51 = t7.*t15.*3.3e+1;
t53 = q0.*t7.*t15.*6.0;
t54 = q0.*t6.*t17.*6.0;
t55 = t6.*t11.*8.0e+1;
t60 = t7.*t15.*1.44e+2;
t61 = t7.*t17.*3.96e+2;
t63 = t17.*t35;
t65 = -t58;
t67 = t6.*t9.*t17.*3.0;
t68 = t6.*t11.*t17.*6.0;
t70 = m.*q0.*t7.*t17.*2.4e+1;
t72 = t7.*t17.*(3.3e+1./2.0);
t74 = -t62;
t75 = t15.*t21.*(3.0./2.0);
t76 = t17.*t21.*(3.0./4.0);
t77 = m.*t6.*t11.*t15;
t78 = m.*t7.*t15.*6.6e+1;
t81 = t4.*t9.*t34;
t82 = q0.*t7.*t17.*4.32e+2;
t88 = t6.*t10.*t17.*2.4e+1;
t96 = t9.*t57;
t97 = q0.*t7.*t15.*-1.44e+2;
t104 = t10.*t16.*t34;
t107 = t7.*t9.*t17.*2.16e+2;
t111 = m.*t7.*t9.*t15.*3.6e+1;
t113 = m.*t7.*t10.*t17.*2.4e+1;
t118 = t7.*t9.*t16.*8.64e+2;
t126 = m.*t7.*t9.*t17.*7.2e+1;
t141 = m.*t6.*t9.*t15.*(-1.0./2.0);
t37 = t29.*2.0;
t46 = -t30;
t52 = t2.*t39;
t59 = -t51;
t66 = t7.*t29.*4.8e+1;
t69 = t7.*t30.*2.4e+1;
t71 = -t60;
t73 = -t61;
t79 = t9.*t49;
t80 = q0.*t60;
t83 = t36./2.0;
t84 = t36./4.0;
t85 = t38./4.0;
t86 = t29.*t34;
t87 = -t68;
t90 = -t70;
t92 = (q0.*t38)./2.0;
t93 = -t75;
t94 = t29.*t35;
t102 = t38./8.0;
t103 = m.*q0.*t7.*t30.*4.8e+1;
t105 = -t88;
t106 = t7.*t30.*5.76e+2;
t109 = t7.*t36.*1.5e+1;
t110 = m.*t7.*t29.*9.6e+1;
t112 = t29.*t39;
t114 = t30.*t39;
t116 = q0.*t6.*t38.*6.0;
t120 = t7.*t36.*1.44e+2;
t121 = m.*t6.*t9.*t40;
t123 = -t111;
t124 = t7.*t38.*1.8e+2;
t125 = q0.*t7.*t29.*-2.88e+2;
t127 = q0.*t7.*t30.*-2.88e+2;
t130 = m.*t7.*t36.*3.0e+1;
t131 = q0.*t7.*t36.*9.0;
t133 = q0.*t7.*t38.*1.8e+1;
t134 = t6.*t10.*t36.*6.0;
t135 = t7.*t9.*t36.*6.0;
t136 = t6.*t9.*t38.*3.0;
t138 = t7.*t9.*t38.*3.0;
t139 = m.*q0.*t7.*t38.*3.6e+1;
t142 = t7.*t38.*(1.5e+1./2.0);
t145 = m.*t6.*t10.*t38;
t147 = q0.*t7.*t36.*2.16e+2;
t150 = q0.*t7.*t38.*1.44e+2;
t151 = t9.*t30.*t34;
t152 = t6.*t9.*t36.*1.2e+1;
t153 = t6.*t11.*t36.*2.4e+1;
t155 = t6.*t11.*t38.*1.2e+1;
t156 = t6.*t10.*t38.*3.6e+1;
t158 = m.*t6.*t8.*t10.*t36;
t159 = m.*t6.*t11.*t38.*4.0;
t160 = t7.*t9.*t29.*-2.88e+2;
t162 = t7.*t9.*t30.*-2.88e+2;
t163 = t9.*t34.*t36;
t164 = t7.*t9.*t38.*1.44e+2;
t165 = m.*t6.*t11.*t36.*-2.0;
t166 = m.*t7.*t9.*t36.*2.4e+1;
t167 = m.*t7.*t9.*t38.*4.8e+1;
t168 = t26+t31+t33;
t89 = -t69;
t91 = q0.*t84;
t95 = q0.*t69;
t99 = -t83;
t100 = -t84;
t101 = -t85;
t108 = -t92;
t115 = -t102;
t117 = -t103;
t119 = -t109;
t122 = -t110;
t128 = t9.*t83;
t129 = t9.*t85;
t132 = -t116;
t137 = m.*t9.*t66;
t140 = -t120;
t143 = -t124;
t144 = t21.*t83;
t146 = -t131;
t148 = t9.*t86;
t149 = -t133;
t154 = -t136;
t157 = -t138;
t161 = -t150;
t170 = -t166;
t174 = t4+t46+t85;
t169 = m.*t6.*t128;
t171 = t37+t99;
t172 = t40+t99;
t173 = t42+t101;
t176 = t21.*t174;
t180 = t41+t100+t108+t128;
t182 = t47+t91+t115+t129;
t185 = (m.*t6.*t23.*(t41+t100+t108+(t9.*t36)./2.0))./2.4e+1;
t186 = t59+t63+t66+t95+t119+t135+t149;
t188 = t35+t43+t45+t50+t53+t72+t89+t94+t142+t146+t157;
t194 = t39+t48+t52+t56+t65+t67+t73+t87+t97+t98+t104+t106+t107+t125+t134+t143+t147+t154+t155+t162+t164;
t195 = t34+t54+t55+t57+t64+t71+t74+t82+t86+t96+t105+t118+t127+t132+t140+t152+t153+t156+t160+t161+t163;
t175 = t21.*t171;
t177 = (m.*t6.*t21.*t172)./2.4e+1;
t181 = t40+t76+t176-1.0;
t187 = (m.*t24.*t186)./2.4e+1;
t189 = t77+t78+t90+t113+t117+t122+t123+t130+t137+t139+t141+t145+t165+t169+t170;
if (t13)
    t192 = t24.*(t77+t78+t113+t130+t137+t139+t141+t145+t165+t169-m.*t7.*t29.*9.6e+1-m.*q0.*t7.*t17.*2.4e+1-m.*q0.*t7.*t30.*4.8e+1-m.*t7.*t9.*t15.*3.6e+1-m.*t7.*t9.*t36.*2.4e+1).*(-1.0./4.8e+1);
else
    t192 = NaN;
end
M = reshape([(m.*t24.*t188)./1.2e+1+(m.*t6.*(t21.*t173+1.0./2.0))./1.2e+1-(m.*t6.*(t23.*t182-1.0./6.0))./1.2e+1-m.*t7.*t22.*t181,t192,t192,(m.*t24.*t194)./2.88e+2],[2,2]);
if nargout > 1
    et1 = dtht.*(t177-t185-(m.*t24.*(t59+t63+t66+t95+t119+t135-q0.*t7.*t38.*1.8e+1))./2.4e+1+(m.*t7.*t22.*(t17+t175-t15.*t21.*(3.0./2.0)))./2.0);
    et2 = -dq0.*((m.*t6.*(t144+t22.*t173))./2.4e+1+m.*t25.*(t35+t43+t45+t53+t72+t89+t94+t142+t157-t4.*t7.*2.4e+1-q0.*t7.*t36.*9.0).*(5.0./2.4e+1)+(m.*t6.*(t144-(t182.*3.0)./t11))./2.4e+1-(m.*t24.*(t7.*1.2e+1-t135-t2.*t7.*1.2e+1+t7.*t9.*6.0+t7.*t15.*6.0-t7.*t29.*1.2e+1-t4.*t35+t7.*t36.*6.0-t30.*t35+q0.*t7.*t38.*1.2e+1))./2.4e+1-m.*t7.*t23.*(t40+t76+t21.*t174-1.0)-(m.*t7.*t22.*(t17.*t22.*(3.0./4.0)+t22.*t174-t21.*(t2-t29+t83)))./2.0);
    et3 = t177-t185-t25.*(t77+t78-t7.*m.*t29.*9.6e+1+t130+t137-t7.*m.*q0.*t17.*2.4e+1-t7.*m.*q0.*t30.*4.8e+1+t139+t141-t7.*m.*t9.*t15.*3.6e+1+t113+t169-t7.*m.*t9.*t36.*2.4e+1+t165+t145).*(5.0./4.8e+1)+(t24.*(t126+t159+t167+m.*q0.*t66-m.*t7.*t17.*2.4e+1+m.*t7.*t30.*4.8e+1-m.*t7.*t38.*2.4e+1-m.*q0.*t6.*t15-m.*q0.*t7.*t15.*7.2e+1+m.*q0.*t6.*t36+m.*q0.*t7.*t36.*2.4e+1+m.*t6.*t10.*t15.*4.0-m.*t7.*t9.*t30.*4.8e+1-m.*t6.*t10.*t36.*6.0+m.*q0.*t6.*t8.*t38))./4.8e+1-(m.*t24.*(t59+t63+t66+t95+t119+t135-q0.*t7.*t38.*1.8e+1))./2.4e+1;
    et4 = (m.*t7.*t22.*(t17+t175-t15.*t21.*(3.0./2.0)))./2.0;
    et5 = dtht;
    et6 = (t24.*(t126+t159+t167-m.*t7.*t17.*1.32e+2+m.*t7.*t30.*1.92e+2-m.*t7.*t38.*6.0e+1-m.*q0.*t7.*t15.*4.8e+1-m.*q0.*t7.*t29.*9.6e+1+m.*q0.*t7.*t36.*7.2e+1+m.*t6.*t9.*t17+m.*t7.*t10.*t15.*4.8e+1-m.*t6.*t11.*t17.*2.0-m.*t7.*t9.*t30.*9.6e+1-m.*t6.*t9.*t38+m.*t6.*t8.*t9.*t36))./4.8e+1-m.*t25.*(t106+t73+t39+t143+t48+t56-t7.*t4.*5.76e+2+t104+t67+t87+t107+t134+t154+t155+t52+t164+t125+t97+t98+t147+t162).*(5.0./5.76e+2)+(m.*t24.*(t34+t54+t55+t57+t64+t71+t82+t86+t96+t105+t118+t127+t140+t152+t153+t156+t160+t163-q0.*t4.*t7.*8.64e+2-q0.*t6.*t38.*6.0-q0.*t7.*t38.*1.44e+2))./5.76e+2;
    et7 = -1.0;
    et8 = --dq0.*((m.*t24.*(t34+t54+t55+t57+t64+t71+t82+t86+t96+t105+t118+t127+t140+t152+t153+t156+t160+t163-q0.*t4.*t7.*8.64e+2-q0.*t6.*t38.*6.0-q0.*t7.*t38.*1.44e+2))./5.76e+2-m.*t25.*(t39+t48+t52+t56+t67+t73+t87+t97+t98+t104+t106+t107+t125+t134+t143+t147+t154+t155+t162+t164-t4.*t7.*5.76e+2).*(5.0./5.76e+2));
    et9 = dtht.*m.*t24.*(t7.*t29.*-1.152e+3+t7.*t15.*7.92e+2+t7.*t36.*3.6e+2-t6.*t9.*t15.*6.0+t6.*t11.*t15.*1.2e+1-t7.*t9.*t15.*4.32e+2+t6.*t9.*t36.*6.0-t153-t7.*t9.*t36.*2.88e+2+t6.*t10.*t38.*1.2e+1-t7.*q0.*t30.*5.76e+2-t7.*q0.*t17.*2.88e+2+t29.*t64+t7.*q0.*t38.*4.32e+2+t7.*t10.*t3.*sin(tht).*5.76e+2).*(-1.0./5.76e+2);
    if (t13)    t0 = et1+et2;else    t0 = NaN;end;if (t13)    t1 = dq0.*(t177-t185-(m.*t24.*(t59+t63+t66+t95+t119+t135-q0.*t7.*t38.*1.8e+1))./2.4e+1+(m.*t7.*t22.*(t17+t175-t15.*t21.*(3.0./2.0)))./2.0)+et5.*et6.*et7;else    t1 = NaN;end;if (t13)    t2 = dtht.*((m.*t24.*(t34+t54+t55+t57+t64+t71+t82+t86+t96+t105+t118+t127+t140+t152+t153+t156+t160+t163-q0.*t4.*t7.*8.64e+2-q0.*t6.*t38.*6.0-q0.*t7.*t38.*1.44e+2))./5.76e+2-m.*t25.*(t39+t48+t52+t56+t67+t73+t87+t97+t98+t104+t106+t107+t125+t134+t143+t147+t154+t155+t162+t164-t4.*t7.*5.76e+2).*(5.0./5.76e+2))-dq0.*(et3+et4);else    t2 = NaN;end;if (t13)    t3 = et8+et9;else    t3 = NaN;end;C = reshape([t0,t1,t2,t3],[2,2]);
end
if nargout > 2
    G = [L.*g.*m.*t23.*t168.*2.0-L.*g.*m.*t22.*(t20-t27);-L.*g.*m.*t22.*(t20-t27+q0.*t18)];
end
if nargout > 3
    P = -L.*g.*m.*t22.*t168;
end
